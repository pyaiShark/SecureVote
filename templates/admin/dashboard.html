{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-3 mb-md-0"><i class="fas fa-tachometer-alt me-2"></i>Admin Dashboard</h1>
  
  <div class="d-flex flex-wrap gap-2">
    <div class="dropdown">
      <button class="btn btn-election btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
        <i class="fas fa-user-plus me-1"></i>Add New
      </button>
      <ul class="dropdown-menu">
        <li>
          <a class="dropdown-item" href="{{ url_for('add_user') }}">
            <i class="fas fa-user me-2"></i>Add User
          </a>
        </li>
        <li>
          <a class="dropdown-item" href="{{ url_for('add_candidate') }}">
            <i class="fas fa-user-tie me-2"></i>Add Candidate
          </a>
        </li>
      </ul>
    </div>
    
    <div class="dropdown">
      <button class="btn btn-outline-election btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
        <i class="fas fa-eye me-1"></i>View
      </button>
      <ul class="dropdown-menu">
        <li>
          <a class="dropdown-item" href="{{ url_for('admin_users') }}">
            <i class="fas fa-users me-2"></i>Users
          </a>
        </li>
        <li>
          <a class="dropdown-item" href="{{ url_for('admin_candidates') }}">
            <i class="fas fa-user-tie me-2"></i>Candidates
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-4 mb-4">
    <div class="vote-card card border-primary">
      <div class="card-body text-center">
        <h1 class="display-4">{{ total_voters }}</h1>
        <p class="text-primary fw-bold">Registered Voters</p>
        <a href="{{ url_for('admin_users') }}" class="btn btn-outline-primary btn-sm">
          <i class="fas fa-users me-1"></i>Manage Users
        </a>
      </div>
    </div>
  </div>
  
  <div class="col-md-4 mb-4">
    <div class="vote-card card border-success">
      <div class="card-body text-center">
        <h1 class="display-4">{{ voted_voters }}</h1>
        <p class="text-success fw-bold">Votes Cast</p>
        <p class="small mb-0">{{ (voted_voters / total_voters * 100) | round(1) }}% Participation</p>
      </div>
    </div>
  </div>
  
  <div class="col-md-4 mb-4">
    <div class="vote-card card border-info">
      <div class="card-body text-center">
        <h1 class="display-4">{{ total_candidates }}</h1>
        <p class="text-info fw-bold">Candidates</p>
        <a href="{{ url_for('admin_candidates') }}" class="btn btn-outline-info btn-sm">
          <i class="fas fa-user-tie me-1"></i>Manage Candidates
        </a>
      </div>
    </div>
  </div>
</div>

<div class="vote-card card mb-4">
  <div class="card-header bg-white">
    <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Voting Activity</h5>
  </div>
  <div class="card-body">
    <canvas id="votingActivityChart" height="250"></canvas>
  </div>
</div>

<div class="row">
  <div class="col-md-6 mb-4">
    <div class="vote-card card h-100">
      <div class="card-header bg-white">
        <h5 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i>Pending Actions</h5>
      </div>
      <div class="list-group list-group-flush" style="padding: 1rem;">
        <div class="list-group-item">
          <div class="d-flex justify-content-between">
            <span>5 Unverified Users</span>
            <a href="#" class="btn btn-sm btn-outline-primary">Review</a>
          </div>
        </div>
        <div class="list-group-item">
          <div class="d-flex justify-content-between">
            <span>3 Vote Disputes</span>
            <a href="#" class="btn btn-sm btn-outline-primary">Review</a>
          </div>
        </div>
        <div class="list-group-item">
          <div class="d-flex justify-content-between">
            <span>System Update Available</span>
            <a href="#" class="btn btn-sm btn-outline-primary">Update</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-6 mb-4" >
    <div class="vote-card card h-100" style="padding: 1rem;">
      <div class="card-header bg-white">
        <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Activity</h5>
      </div>
      <div class="list-group list-group-flush">
        <div class="list-group-item">
          <div class="d-flex">
            <div class="flex-shrink-0">
              <i class="fas fa-user-plus text-success"></i>
            </div>
            <div class="flex-grow-1 ms-3">
              <p class="mb-0">New voter registered: John Smith</p>
              <small class="text-muted">2 minutes ago</small>
            </div>
          </div>
        </div>
        <div class="list-group-item">
          <div class="d-flex">
            <div class="flex-shrink-0">
              <i class="fas fa-vote-yea text-primary"></i>
            </div>
            <div class="flex-grow-1 ms-3">
              <p class="mb-0">Vote recorded for Alex Morgan</p>
              <small class="text-muted">15 minutes ago</small>
            </div>
          </div>
        </div>
        <div class="list-group-item">
          <div class="d-flex">
            <div class="flex-shrink-0">
              <i class="fas fa-user-tie text-info"></i>
            </div>
            <div class="flex-grow-1 ms-3">
              <p class="mb-0">Candidate James Wilson updated</p>
              <small class="text-muted">1 hour ago</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Voting activity chart
    const ctx = document.getElementById('votingActivityChart').getContext('2d');
    const activityChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00'],
        datasets: [{
          label: 'Votes per hour',
          data: [120, 190, 140, 220, 182, 124, 210, 185],
          borderColor: 'rgba(13, 59, 102, 1)',
          backgroundColor: 'rgba(13, 59, 102, 0.1)',
          borderWidth: 3,
          pointBackgroundColor: 'rgba(13, 59, 102, 1)',
          pointRadius: 5,
          pointHoverRadius: 7,
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            },
            ticks: {
              callback: function(value) {
                return value;
              }
            }
          },
          x: {
            grid: {
              display: false
            }
          }
        }
      }
    });
  });
</script>
{% endblock %}